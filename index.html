<html>

<meta charset="UTF-8"> 

<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>

	<script src="flot/jquery.flot.js"></script>
	<script type="text/javascript">
var d_res

var ncomps = 2;

var N = ncomps + 1;

var omegas = [.3089,.6911];
var ws = [0.,-1.];

var rH0 = 14.4;

var omega_k = - 0;

for (i=0; i<ncomps; i++)
	omegas[i] *= 1 - omega_k;

var ys=[0.];


function f(y) {
	var tot_omega = 0;

	for(var i=1; i<1+ncomps; i++) { tot_omega += y[i]; }


	var disc =  y[0]*y[0] * tot_omega + omega_k;


	if (disc < 0)
		disc = 0;

	ap = Math.sqrt(disc);

	out = [ap];

	for(var i=1; i<1+ncomps; i++)
	{
		out.push( - 3*(1+ws[i-1]) * ap / y[0] * y[i] );
	};


	return out;


};

function mult(v,scalar)
{
	out = [];
	for(i = 0; i< N; i++)
		out.push(scalar * v[i]);
	return out;
}

function sum(a,b)
{
	out = [];
	for(i = 0; i < N; i++)
		out.push(a[i]+b[i]);
	return out;
}

function integrate() {
	var h = 0.01;

	ys = [ ];
	yback = [ ];

	var d_res = document.getElementById("res");
	d_res.innerHTML = "";

	for (sgn = -1; sgn < 2; sgn+= 2)
	{
		var y = [1.].concat(omegas);

		var t = 0;

		for(it = 0; it < 100; it ++)
		{
			if (y[0] <= 0.02)
			{
				break;
			}

			//d_res.innerHTML += y.toString() + "<br>";		
			if (sgn > 0)
				ys.push([t,y]);
			else
				ys.unshift([t,y]);

			var k1 = f(y);
			var k2 = f(sum(y,mult(k1,sgn*h/2)));
			var k3 = f(sum(y,mult(k2,sgn*h/2)));
			var k4 = f(sum(y,mult(k3,sgn*h)));

			y = sum(y , 
					mult( 
						sum(
						     sum(k1,mult(k2,2)),
						     sum(mult(k3,2),k4)
						),
						sgn*h/6)
			       );

			t += sgn*h;


		};
	};

	d_res.innerHTML += omegas[0].toString() + "\n" + omegas[1].toString() + "\n";
	d_res.innerHTML += "BB was "+(ys[0][0]*rH0).toString() + " Gy ago.";

};

function draw() {


	var data_t = [];
	var data_y = [];
	var data_points = [];
	var data_content = [];
	for (j=0; j<ncomps; j++)
		data_content.push([]);

	for (var i = 0; i<ys.length; i+=1)
	{	
 	 data_t.push(ys[i][0] * rH0 );
	 data_y.push(ys[i][1][0]);

	 data_points.push([ys[i][0] * rH0,ys[i][1][0]]);
	 
	 for (j=0; j<ncomps; j++)
		 data_content[j].push([ys[i][0] * rH0,ys[i][1][j+1]]);
	 };

	
	plots = [];

	var names = ["&Omega;_m","&Omega;_&Lambda;"]

	for(j=0; j<ncomps; j++)
	 	plots.push( {label:names[j], data:data_content[j]});

	var marking = [
			{ color: "#000", lineWidth: 1, xaxis: { from: 0, to: 0 } }
		];


	$.plot("#placeholder",[{label:"a(t)", data:data_points}].concat(plots),
	
 	{
	  yaxis: {
		min:0,
		max:4
	  },
	  grid: {
		  markings:marking
	  }
	}	


	);


}

function recompute() {

	omegas[1] = $( "#ratioslider" ).slider("value") * 0.001;
	omegas[0] = 1. - omegas[1];

	integrate();
	draw();
 }


window.onload = function() {
	 $( "#ratioslider" ).slider({
	 	min: 0,
	 	max: 1000,
	 	value: 691
	 });

	 
	$( "#recalc" )
	.button()
	.click(recompute);
	

	recompute();

};
	</script>

</head>

	<body>
		<div id="ratioslider"></div> 
		<button id="recalc">Recompute</button>
		<div class="demo-container">
			<div id="placeholder" class="demo-placeholder" style="width:400px; height:400px;"></div>
		</div>

		<p id="res"></div>

	</body>
